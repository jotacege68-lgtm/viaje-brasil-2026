<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Brasil 2026 - Vista Max</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        :root { --p1-color: #0284c7; --p2-color: #e11d48; --bg: #f8fafc; --header-h: 100px; --accent: #16a34a; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding-top: calc(var(--header-h) + 20px); color: #334155; }
        
        /* PestaÃ±as con texto extra grande y sin Ã­conos */
        .tabs { position: fixed; top: 0; width: 100%; background: #0f172a; display: flex; height: var(--header-h); box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 1000; }
        .tab-btn { flex: 1; border: none; background: none; font-size: 18px; font-weight: 900; color: #94a3b8; text-transform: uppercase; cursor: pointer; display: flex; align-items: center; justify-content: center; text-align: center; line-height: 1.1; padding: 0 5px; }
        .tab-btn.active { color: #fbbf24; background: #1e293b; border-bottom: 8px solid #fbbf24; font-size: 19px; }
        
        .container { padding: 15px; display: none; max-width: 600px; margin: auto; }
        .container.active { display: block; }

        .card { background: white; padding: 25px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; }
        h2 { font-size: 26px; font-weight: 900; margin-top: 0; color: #1e293b; text-transform: uppercase; border-bottom: 4px solid #fbbf24; display: inline-block; margin-bottom: 20px; }
        
        label { display: block; margin-bottom: 8px; font-size: 15px; font-weight: 800; color: #475569; text-transform: uppercase; }
        select, input { width: 100%; padding: 18px; margin-bottom: 15px; border: 2px solid #cbd5e1; border-radius: 12px; font-size: 20px; box-sizing: border-box; color: #000; }
        
        .btn-save { background: var(--accent); color: white; padding: 22px; border: none; border-radius: 15px; font-weight: 900; font-size: 22px; cursor: pointer; width: 100%; box-shadow: 0 5px 0 #15803d; }
        
        .seccion-titulo { background: #334155; color: white; padding: 12px 15px; border-radius: 10px; font-size: 18px; font-weight: 800; margin: 25px 0 15px 0; text-align: center; }
        .historial-item { padding: 15px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; font-size: 17px; }

        .reporte-tabla { width: 100%; border-collapse: collapse; font-size: 15px; }
        .reporte-tabla th { text-align: left; padding: 10px; border-bottom: 2px solid #e2e8f0; color: #64748b; font-size: 12px; }
        .reporte-tabla td { padding: 12px 10px; border-bottom: 1px solid #f1f5f9; }
        .resaltado-pesos { color: #16a34a; font-weight: 800; }
        
        .balance-card { text-align: center; padding: 25px; background: #1e293b; color: white; border-radius: 20px; margin-bottom: 20px; }
        .parejas-arriba { display: flex; justify-content: space-around; margin-bottom: 20px; font-size: 22px; font-weight: 900; color: #fbbf24; }
        .parejas-arriba small { font-size: 13px; color: #94a3b8; display: block; text-transform: uppercase; }
        .monto-abajo { font-size: 42px; font-weight: 900; border-top: 1px solid #475569; padding-top: 15px; }

        .resultado-final { padding: 20px; border-radius: 15px; font-weight: 900; text-align: center; font-size: 20px; border: 3px solid transparent; margin-bottom: 10px; }
        .gana-p1 { background: #dbeafe; color: #1e40af; border-color: #3b82f6; }
        .gana-p2 { background: #ffe4e6; color: #9f1239; border-color: #f43f5e; }

        .liquidador-box { background: #fdf2f8; border: 2px solid #f472b6; border-radius: 20px; padding: 20px; margin-top: 30px; }
        .input-cambio { background: #fff; border: 2px solid #cbd5e1; font-weight: bold; text-align: center; font-size: 22px; }
    </style>
</head>
<body>

<nav class="tabs">
    <button class="tab-btn active" onclick="showTab('CARGAR', this)">NUEVO GASTO</button>
    <button class="tab-btn" onclick="showTab('HISTORIAL', this)">HISTORIAL</button>
    <button class="tab-btn" onclick="showTab('BALANCE', this)">BALANCE FINAL</button>
</nav>

<div id="CARGAR" class="container active">
    <h2>NUEVO GASTO</h2>
    <div class="card">
        <label>Â¿QuiÃ©n PagÃ³?</label>
        <select id="pagador">
            <optgroup label="Pareja 1">
                <option value="JUAN">Juan</option>
                <option value="TANIA">Tania</option>
            </optgroup>
            <optgroup label="Pareja 2">
                <option value="ROSARIO">Rosario</option>
                <option value="RICHARD">Richard</option>
            </optgroup>
        </select>
        <label>Moneda</label>
        <select id="moneda">
            <option value="REALES">REALES (R$)</option>
            <option value="PESOS">PESOS ($)</option>
        </select>
        <label>Monto</label>
        <input type="number" id="monto" inputmode="decimal" placeholder="0.00">
        <label>Rubro</label>
        <select id="rubro" onchange="checkOtro(this)">
            <option value="COMIDA FUERA">Comida fuera</option>
            <option value="SUPER">Super</option>
            <option value="BEBIDAS">Bebidas</option>
            <option value="ALOJAMIENTO">Alojamiento</option>
            <option value="NAFTA">Nafta</option>
            <option value="PEAJES">Peajes</option>
            <option value="VARIOS">Varios (Otro)</option>
        </select>
        <input type="text" id="rubro-otro" placeholder="Â¿QuÃ© gasto fue?" style="display:none; margin-top: 10px;">
        <button class="btn-save" onclick="guardarGasto()">ðŸ’¾ GUARDAR GASTO</button>
    </div>
</div>

<div id="HISTORIAL" class="container">
    <h2>HISTORIAL</h2>
    <div class="card" style="padding:15px">
        <label style="font-size:16px; color:#1e293b">REPORTE POR RUBRO</label>
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px; background:#f1f5f9; padding:10px; border-radius:10px;">
            <small style="font-weight:bold; font-size:11px;">TIPO CAMBIO:</small>
            <input type="number" id="tc-reporte" placeholder="Ej: 8.5" style="margin:0; padding:8px; font-size:16px;" oninput="generarReporteRubros()">
        </div>
        <table class="reporte-tabla" id="tabla-rubros">
            <thead>
                <tr><th>RUBRO</th><th>REALES</th><th>PESOS</th><th>TOTAL ($)</th></tr>
            </thead>
            <tbody id="body-reporte"></tbody>
        </table>
    </div>
    <div id="listas-por-moneda"></div>
</div>

<div id="BALANCE" class="container">
    <h2>BALANCE FINAL</h2>
    <div class="card" style="background: #f1f5f9; padding: 15px;">
        <label>REVISAR MONEDA INDIVIDUAL:</label>
        <select id="moneda-balance" onchange="calcularBalance()" style="margin-bottom:0">
            <option value="REALES">REALES (R$)</option>
            <option value="PESOS">PESOS ($)</option>
        </select>
    </div>
    <div class="card">
        <label>Gastos por persona:</label>
        <div id="detalle-individual" style="font-size: 20px;"></div>
    </div>
    <div class="balance-card">
        <div class="parejas-arriba">
            <div><small>Pareja 1 (J+T)</small><span id="total-p1">0</span></div>
            <div><small>Pareja 2 (R+R)</small><span id="total-p2">0</span></div>
        </div>
        <div class="monto-abajo"><div id="total-viaje">0</div></div>
    </div>
    <div id="veredicto" class="resultado-final"></div>
    <div class="liquidador-box">
        <h3 style="margin-top:0; color:#be185d; text-align:center; font-size:20px;">ðŸ’° CIERRE TOTAL (PESOS)</h3>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <label style="margin:0">COTIZACIÃ“N REAL:</label>
            <input type="number" id="tc-real" class="input-cambio" placeholder="0.00" style="width:130px; margin:0; border-color:#f472b6; color:#be185d" oninput="liquidarTodo()">
        </div>
        <div id="detalles-conversion" style="font-size:16px; border-top:1px dashed #f472b6; padding-top:10px; margin-bottom:15px; text-align:center;"></div>
        <div id="veredicto-final-pesos" class="resultado-final" style="background:#fff; border-color:#be185d; color:#be185d; font-size:24px;">Ingresa cotizaciÃ³n...</div>
    </div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyBDlHjKXf33pCEznyLAmFrTDXVPevrHe9Q",
      authDomain: "gastoscasa-d8bc2.firebaseapp.com",
      databaseURL: "https://gastoscasa-d8bc2-default-rtdb.firebaseio.com",
      projectId: "gastoscasa-d8bc2",
      storageBucket: "gastoscasa-d8bc2.firebasestorage.app",
      messagingSenderId: "749635992986",
      appId: "1:749635992986:web:7916d888f54eb5c3ab0e23"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const GRUPO_1 = ["JUAN", "TANIA"];
    const GRUPO_2 = ["ROSARIO", "RICHARD"];

    let todosLosGastos = [];
    let sumasGlobales = { P1: { REALES: 0, PESOS: 0 }, P2: { REALES: 0, PESOS: 0 } };

    function showTab(id, btn) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        if(id === 'HISTORIAL') cargarHistorial();
        if(id === 'BALANCE') calcularBalance();
        window.scrollTo(0,0);
    }

    function checkOtro(s) { document.getElementById('rubro-otro').style.display = s.value === 'VARIOS' ? 'block' : 'none'; }

    function guardarGasto() {
        const pagador = document.getElementById('pagador').value;
        const moneda = document.getElementById('moneda').value;
        const monto = parseFloat(document.getElementById('monto').value);
        let rubro = document.getElementById('rubro').value;
        if(rubro === 'VARIOS' && document.getElementById('rubro-otro').value !== "") rubro = "VAR: " + document.getElementById('rubro-otro').value;
        if (!monto || monto <= 0) return alert("Monto invÃ¡lido");
        db.ref('viaje_brasil_2026').push({
            pagador, moneda, monto, rubro,
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            fecha: new Date().toLocaleDateString('es-UY')
        }).then(() => { alert("âœ… Guardado"); document.getElementById('monto').value = ""; });
    }

    function cargarHistorial() {
        db.ref('viaje_brasil_2026').once('value', s => {
            const gastos = { REALES: [], PESOS: [] };
            todosLosGastos = [];
            s.forEach(c => {
                const g = c.val(); g.id = c.key;
                todosLosGastos.push(g);
                if(gastos[g.moneda]) gastos[g.moneda].push(g);
            });
            generarReporteRubros();
            let html = "";
            ["REALES", "PESOS"].forEach(m => {
                if(gastos[m].length > 0) {
                    html += `<div class="seccion-titulo">GASTOS EN ${m}</div>`;
                    gastos[m].reverse().forEach(g => {
                        html += `<div class="card historial-item">
                            <div><small>${g.fecha}</small><br><b style="font-size:18px">${g.rubro}</b><br><small>PagÃ³: ${g.pagador}</small></div>
                            <div style="text-align:right"><b>${m === 'REALES' ? 'R$' : '$'} ${g.monto}</b><br>
                            <button onclick="borrar('${g.id}')" style="color:#e11d48; border:1px solid #e11d48; background:none; font-size:11px; padding:4px; border-radius:5px; margin-top:5px;">ELIMINAR</button></div>
                        </div>`;
                    });
                }
            });
            document.getElementById('listas-por-moneda').innerHTML = html || "<p style='text-align:center'>Sin gastos.</p>";
        });
    }

    function generarReporteRubros() {
        const tc = parseFloat(document.getElementById('tc-reporte').value) || 0;
        const rubrosData = {};
        todosLosGastos.forEach(g => {
            let r = g.rubro;
            if(r.startsWith("VAR:")) r = "VARIOS";
            if(!rubrosData[r]) rubrosData[r] = { REALES: 0, PESOS: 0 };
            rubrosData[r][g.moneda] += g.monto;
        });
        let html = "";
        for(const r in rubrosData) {
            const totalConvertido = rubrosData[r].PESOS + (rubrosData[r].REALES * tc);
            html += `<tr><td style="font-weight:bold">${r}</td><td>R$ ${rubrosData[r].REALES.toLocaleString('es-UY')}</td><td>$ ${rubrosData[r].PESOS.toLocaleString('es-UY')}</td><td class="resaltado-pesos">${tc > 0 ? '$ ' + totalConvertido.toLocaleString('es-UY', {maximumFractionDigits:0}) : '-'}</td></tr>`;
        }
        document.getElementById('body-reporte').innerHTML = html || "<tr><td colspan='4'>No hay datos</td></tr>";
    }

    function borrar(id) { if(confirm("Â¿Borrar?")) db.ref(`viaje_brasil_2026/${id}`).remove().then(()=>cargarHistorial()); }

    function calcularBalance() {
        const monSel = document.getElementById('moneda-balance').value;
        db.ref('viaje_brasil_2026').once('value', s => {
            sumasGlobales = { P1: { REALES: 0, PESOS: 0 }, P2: { REALES: 0, PESOS: 0 } };
            let ind = {JUAN:0, TANIA:0, ROSARIO:0, RICHARD:0};
            s.forEach(c => {
                const g = c.val();
                const pareja = GRUPO_1.includes(g.pagador) ? 'P1' : 'P2';
                sumasGlobales[pareja][g.moneda] += g.monto;
                if(g.moneda === monSel) ind[g.pagador] += g.monto;
            });
            const tP1 = sumasGlobales.P1[monSel], tP2 = sumasGlobales.P2[monSel], total = tP1 + tP2, dif = tP1 - (total/2), sim = (monSel === 'REALES' ? 'R$' : '$');
            document.getElementById('total-viaje').innerText = `${sim} ${total.toLocaleString('es-UY')}`;
            document.getElementById('total-p1').innerText = `${sim} ${tP1.toLocaleString('es-UY')}`;
            document.getElementById('total-p2').innerText = `${sim} ${tP2.toLocaleString('es-UY')}`;
            const v = document.getElementById('veredicto');
            v.className = "resultado-final " + (dif > 0 ? "gana-p1" : "gana-p2");
            v.innerHTML = total === 0 ? "Sin gastos" : (dif > 0 ? `LA PAREJA 2 ADEUDA<br><span style="font-size:28px">${sim} ${Math.abs(dif).toLocaleString('es-UY')}</span><br>A LA PAREJA 1` : `LA PAREJA 1 ADEUDA<br><span style="font-size:28px">${sim} ${Math.abs(dif).toLocaleString('es-UY')}</span><br>A LA PAREJA 2`);
            let hInd = "";
            for(let p in ind) hInd += `<div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>${p}:</span> <b>${sim} ${ind[p].toLocaleString('es-UY')}</b></div>`;
            document.getElementById('detalle-individual').innerHTML = hInd;
            liquidarTodo();
        });
    }

    function liquidarTodo() {
        const tcR = parseFloat(document.getElementById('tc-real').value);
        const vf = document.getElementById('veredicto-final-pesos');
        const det = document.getElementById('detalles-conversion');
        if(isNaN(tcR)) { vf.innerText = "Ingresa cotizaciÃ³n..."; det.innerHTML = ""; return; }
        const p1Total = sumasGlobales.P1.PESOS + (sumasGlobales.P1.REALES * tcR);
        const p2Total = sumasGlobales.P2.PESOS + (sumasGlobales.P2.REALES * tcR);
        const totalGral = p1Total + p2Total, difFinal = p1Total - (totalGral / 2);
        det.innerHTML = `P1: $ ${p1Total.toLocaleString('es-UY', {maximumFractionDigits:0})} | P2: $ ${p2Total.toLocaleString('es-UY', {maximumFractionDigits:0})}`;
        vf.innerHTML = totalGral === 0 ? "Esperando datos..." : (difFinal > 0 ? `<small>DEUDA FINAL:</small><br>PAREJA 2 ADEUDA A PAREJA 1<br><b>$ ${Math.abs(difFinal).toLocaleString('es-UY', {maximumFractionDigits:0})}</b>` : `<small>DEUDA FINAL:</small><br>PAREJA 1 ADEUDA A PAREJA 2<br><b>$ ${Math.abs(difFinal).toLocaleString('es-UY', {maximumFractionDigits:0})}</b>`);
    }
</script>
</body>
</html>
