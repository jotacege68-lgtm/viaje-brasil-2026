<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Brasil 2026 - Multimoneda</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        :root { --p1-color: #0284c7; --p2-color: #e11d48; --bg: #f8fafc; --header-h: 70px; --accent: #16a34a; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding-top: calc(var(--header-h) + 20px); color: #334155; }
        
        .tabs { position: fixed; top: 0; width: 100%; background: #0f172a; display: flex; height: var(--header-h); box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 1000; }
        .tab-btn { flex: 1; border: none; background: none; font-size: 11px; font-weight: 700; color: #94a3b8; text-transform: uppercase; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px;}
        .tab-btn.active { color: #fbbf24; background: #1e293b; border-bottom: 4px solid #fbbf24; }
        
        .container { padding: 15px; display: none; max-width: 600px; margin: auto; }
        .container.active { display: block; }

        .card { background: white; padding: 20px; border-radius: 16px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; }
        label { display: block; margin-bottom: 6px; font-size: 12px; font-weight: 800; color: #64748b; text-transform: uppercase; }
        select, input { width: 100%; padding: 14px; margin-bottom: 12px; border: 2px solid #cbd5e1; border-radius: 12px; font-size: 16px; box-sizing: border-box; }
        
        .btn-save { background: var(--accent); color: white; padding: 18px; border: none; border-radius: 12px; font-weight: 900; font-size: 16px; cursor: pointer; width: 100%; }
        
        .moneda-badge { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 900; margin-right: 5px; }
        .m-reales { background: #fef08a; color: #854d0e; }
        .m-pesos { background: #dcfce7; color: #166534; }
        .m-dolares { background: #dbeafe; color: #1e40af; }

        .historial-item { padding: 12px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; }
        .seccion-titulo { background: #334155; color: white; padding: 8px 15px; border-radius: 8px; font-size: 13px; font-weight: 800; margin: 20px 0 10px 0; }

        .balance-card { text-align: center; padding: 20px; background: #1e293b; color: white; border-radius: 16px; margin-bottom: 15px; }
        .big-number { font-size: 2.2rem; font-weight: 900; margin: 10px 0; color: #fbbf24; }
        .resultado-final { padding: 15px; border-radius: 12px; font-weight: 800; text-align: center; }
        .gana-p1 { background: #dbeafe; color: #1e40af; }
        .gana-p2 { background: #ffe4e6; color: #9f1239; }
    </style>
</head>
<body>

<nav class="tabs">
    <button class="tab-btn active" onclick="showTab('CARGAR', this)">‚ûï <br>Nuevo</button>
    <button class="tab-btn" onclick="showTab('HISTORIAL', this)">üìÖ <br>Historial</button>
    <button class="tab-btn" onclick="showTab('BALANCE', this)">üìä <br>Balance Final</button>
</nav>

<div id="CARGAR" class="container active">
    <div class="card">
        <label>¬øQui√©n Pag√≥?</label>
        <select id="pagador">
            <optgroup label="Pareja 1">
                <option value="JUAN">Juan</option>
                <option value="TANIA">Tania</option>
            </optgroup>
            <optgroup label="Pareja 2">
                <option value="ROSARIO">Rosario</option>
                <option value="RICHARD">Richard</option>
            </optgroup>
        </select>

        <label>Moneda</label>
        <select id="moneda">
            <option value="REALES">REALES (R$)</option>
            <option value="PESOS">PESOS ($)</option>
            <option value="DOLARES">D√ìLARES (U$S)</option>
        </select>

        <label>Monto</label>
        <input type="number" id="monto" inputmode="decimal" placeholder="0.00">

        <label>Rubro</label>
        <select id="rubro" onchange="checkOtro(this)">
            <option value="COMIDA">üçî Comida</option>
            <option value="SUPER">üõí Super</option>
            <option value="ALOJAMIENTO">üè® Alojamiento</option>
            <option value="NAFTA/PEAJES">‚õΩ Nafta/Peajes</option>
            <option value="VARIOS">üîπ Varios</option>
            <option value="OTRO">‚úèÔ∏è Otro...</option>
        </select>
        <input type="text" id="rubro-otro" placeholder="¬øQu√© gasto fue?" style="display:none;">

        <button class="btn-save" onclick="guardarGasto()">üíæ GUARDAR</button>
    </div>
</div>

<div id="HISTORIAL" class="container">
    <div id="listas-por-moneda">
        </div>
</div>

<div id="BALANCE" class="container">
    <div class="card" style="background: #f1f5f9;">
        <label>VER BALANCE EN:</label>
        <select id="moneda-balance" onchange="calcularBalance()">
            <option value="REALES">REALES (R$)</option>
            <option value="PESOS">PESOS ($)</option>
            <option value="DOLARES">D√ìLARES (U$S)</option>
        </select>
    </div>

    <div class="balance-card">
        <span id="txt-moneda-total">TOTAL DEL VIAJE</span>
        <div class="big-number" id="total-viaje">0</div>
        <div style="display: flex; justify-content: space-between; margin-top:15px;">
            <div><small>P1 (J+T)</small><br><span id="total-p1">0</span></div>
            <div style="border-left:1px solid #475569;"></div>
            <div><small>P2 (R+R)</small><br><span id="total-p2">0</span></div>
        </div>
    </div>

    <div id="veredicto" class="resultado-final"></div>

    <div class="card">
        <label>Detalle por Integrante</label>
        <div id="detalle-individual"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyBDlHjKXf33pCEznyLAmFrTDXVPevrHe9Q",
      authDomain: "gastoscasa-d8bc2.firebaseapp.com",
      databaseURL: "https://gastoscasa-d8bc2-default-rtdb.firebaseio.com",
      projectId: "gastoscasa-d8bc2",
      storageBucket: "gastoscasa-d8bc2.firebasestorage.app",
      messagingSenderId: "749635992986",
      appId: "1:749635992986:web:7916d888f54eb5c3ab0e23"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const GRUPO_1 = ["JUAN", "TANIA"];
    const GRUPO_2 = ["ROSARIO", "RICHARD"];

    function showTab(id, btn) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        if(id === 'HISTORIAL') cargarHistorial();
        if(id === 'BALANCE') calcularBalance();
    }

    function checkOtro(s) { document.getElementById('rubro-otro').style.display = s.value === 'OTRO' ? 'block' : 'none'; }

    function guardarGasto() {
        const pagador = document.getElementById('pagador').value;
        const moneda = document.getElementById('moneda').value;
        const monto = parseFloat(document.getElementById('monto').value);
        let rubro = document.getElementById('rubro').value;
        if(rubro === 'OTRO') rubro = document.getElementById('rubro-otro').value;

        if (!monto || monto <= 0) return alert("Monto inv√°lido");

        db.ref('viaje_brasil_2026').push({
            pagador, moneda, monto, rubro,
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            fecha: new Date().toLocaleDateString('es-UY')
        }).then(() => {
            alert("‚úÖ Guardado");
            document.getElementById('monto').value = "";
        });
    }

    function cargarHistorial() {
        db.ref('viaje_brasil_2026').once('value', s => {
            const gastos = { REALES: [], PESOS: [], DOLARES: [] };
            s.forEach(c => {
                const g = c.val();
                g.id = c.key;
                if(gastos[g.moneda]) gastos[g.moneda].push(g);
            });

            let html = "";
            ["REALES", "PESOS", "DOLARES"].forEach(m => {
                if(gastos[m].length > 0) {
                    html += `<div class="seccion-titulo">LISTA ${m}</div>`;
                    gastos[m].reverse().forEach(g => {
                        html += `<div class="card historial-item">
                            <div><small>${g.fecha}</small><br><b>${g.rubro}</b><br><small>${g.pagador}</small></div>
                            <div style="text-align:right"><b>${m === 'REALES' ? 'R$' : m === 'PESOS' ? '$' : 'U$S'} ${g.monto}</b><br>
                            <button onclick="borrar('${g.id}')" style="color:red; border:none; background:none; font-size:10px;">Eliminar</button></div>
                        </div>`;
                    });
                }
            });
            document.getElementById('listas-por-moneda').innerHTML = html || "<p style='text-align:center'>No hay gastos</p>";
        });
    }

    function borrar(id) { if(confirm("¬øBorrar?")) db.ref(`viaje_brasil_2026/${id}`).remove().then(()=>cargarHistorial()); }

    function calcularBalance() {
        const monSel = document.getElementById('moneda-balance').value;
        db.ref('viaje_brasil_2026').once('value', s => {
            let tP1 = 0, tP2 = 0, ind = {JUAN:0, TANIA:0, ROSARIO:0, RICHARD:0};
            s.forEach(c => {
                const g = c.val();
                if(g.moneda === monSel) {
                    if(GRUPO_1.includes(g.pagador)) tP1 += g.monto; else tP2 += g.monto;
                    ind[g.pagador] += g.monto;
                }
            });

            const total = tP1 + tP2;
            const dif = tP1 - (total/2);
            const sim = monSel === 'REALES' ? 'R$' : monSel === 'PESOS' ? '$' : 'U$S';

            document.getElementById('total-viaje').innerText = `${sim} ${total.toFixed(0)}`;
            document.getElementById('total-p1').innerText = `${sim} ${tP1.toFixed(0)}`;
            document.getElementById('total-p2').innerText = `${sim} ${tP2.toFixed(0)}`;

            const v = document.getElementById('veredicto');
            v.className = "resultado-final " + (dif > 0 ? "gana-p1" : "gana-p2");
            v.innerText = dif > 0 ? `PAREJA 2 DEBE A PAREJA 1: ${sim} ${Math.abs(dif).toFixed(0)}` : `PAREJA 1 DEBE A PAREJA 2: ${sim} ${Math.abs(dif).toFixed(0)}`;

            let hInd = "";
            for(let p in ind) hInd += `<div style="display:flex; justify-content:space-between; font-size:14px; margin-bottom:5px;"><span>${p}</span> <b>${sim} ${ind[p].toFixed(0)}</b></div>`;
            document.getElementById('detalle-individual').innerHTML = hInd;
        });
    }
</script>
</body>
</html>
